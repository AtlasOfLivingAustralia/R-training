---
title: "Sharing biodiversity data with `galaxias`"
author: "Peggy Newman & Dax Kellie
  <br>
  ![](images/ALA_Logo.png){style='width: auto; height: 150px; margin-top: 80px; padding-left: 20px; padding-right: 20px'}![](images/NCRIS_logo.png){style='width: auto; height: 150px; margin-top: 80px; padding-left: 20px; padding-right: 20px'} ![](images/CSIRO_logo.png){style='width: auto; height: 150px; margin-top: 80px; padding-left: 20px; padding-right: 20px'}"
format:
  revealjs: 
    theme: [default, custom.scss] 
    transition: fade
editor: visual
---

## Darwin Core

```{r, echo = FALSE}
fontawesome::fa_html_dependency()
```
An archive is a `.zip` file containing three things:


```{=html}
<table>
  <tbody>
    <tr>
      <td>{{< fa frog size=5x >}}</td>
      <td>{{< fa clipboard size=3x >}}</td>
      <td>{{< fa list size=3x >}}</td>
    </tr>
    <tr>
      <td>observations</td>
      <td>metadata</td>
      <td>schema</td>
    </tr>
  </tbody>
</table>
```

- biodiversity observations or _occurrences_ (in `.csv` format)
- a _metadata_ statement (in Ecological Meta Language with a `.xml` extension)
- a _schema_ document (in `.xml` format), usually autogenerated


## Worked example

Westgate et al. (2016) Data from: Citizen science program shows urban areas have lower occurrence of frog species, but not accelerated declines. https://doi.org/10.5061/dryad.75s51


## Data Import
Observations

```{r, echo = TRUE}
library(readxl)
library(dplyr)
library(janitor)
obs <- read_xlsx("data-raw/Frogwatch_dataset.xlsx", 
                 sheet = "observations") |>
  clean_names()
glimpse(obs)
```

## Data Import
Sites
```{r, echo = TRUE}
sites <- read_xlsx("data-raw/Frogwatch_dataset.xlsx", 
                   sheet = "sites") |>
  clean_names()
glimpse(sites)
```

## Data Import
Species
```{r, echo = TRUE}
spp <- read_xlsx("data-raw/Frogwatch_dataset.xlsx", 
                 sheet = "species list") |>
  clean_names()
spp
```

## Data Manipulation
Restrict to 'useful' columns
```{r, echo = TRUE}
obs <- obs |>
  select(site_code, year, any_of(spp$abbreviation)) |>
  mutate(visit_id = seq_len(nrow(obs)),
         .after = 1)
print(obs, n = 5)
```

## Data Manipulation
Add spatial fields
```{r, echo = TRUE}
obs <- obs |>
  left_join(select(sites, site_code, latitude, longitude),
            by = "site_code") |>
  relocate(latitude, longitude, .after = visit_id)
print(obs, n = 5)
```

## Data Manipulation
Convert from wide to long format, add species names
```{r, echo = TRUE}
library(tidyr)
obs_long <- pivot_longer(obs,
                         cols = spp$abbreviation,
                         names_to = "abbreviation") |>
  left_join(spp, by = "abbreviation") |>
  select(-abbreviation) |>
  relocate(value, .after = last_col())
print(obs_long, n = 5)
```

## Darwin Core manipulation
Get suggestions
```{r, echo = FALSE}
```

```{r, eval = FALSE, echo = TRUE}
library(galaxias)
suggest_workflow(obs_long)
```

## Darwin Core manipulation
Make an 'event' dataset
```{r, echo = TRUE}
events <- obs_long |>
  group_by(visit_id) |>
  slice(1)
```


